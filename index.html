<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>متجر دارغون سوداني</title>
<style>
/* ---------- Reset & base ---------- */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: "Tajawal", system-ui, Arial, sans-serif;
  background: #05060b;
  color:#fff;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden;
  min-height:100vh;
}

/* ---------- Live background (canvas) ---------- */
#bg{position:fixed;inset:0;z-index:-2;pointer-events:none}

/* ---------- Header ---------- */
.header{
  position:fixed;top:0;left:0;right:0;height:64px;
  background:rgba(6,8,12,0.86);backdrop-filter:blur(6px);
  display:flex;align-items:center;justify-content:space-between;padding:0 14px;z-index:50;border-bottom:1px solid rgba(255,255,255,0.03);
}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(90deg,#00e0ff,#0066ff);display:grid;place-items:center;color:#001;font-weight:800}
.header h1{font-size:16px}
.header .controls{display:flex;gap:10px;align-items:center}

/* ---------- Sidebar ---------- */
.sidebar-toggle{cursor:pointer;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
.sidebar{
  position:fixed;top:64px;right:-320px;width:320px;height:calc(100% - 64px);
  background:#071023;padding:16px;transition:right .26s;z-index:60;border-left:1px solid rgba(255,255,255,0.03);overflow:auto;
}
.sidebar.open{right:0}
.side-section{margin-bottom:14px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02)}
.side-title{font-weight:800;margin-bottom:8px}
.side-link{display:block;padding:8px;border-radius:8px;color:#fff;text-decoration:none;margin-bottom:6px}
.side-link:hover{background:rgba(255,255,255,0.02)}

/* ---------- Main ---------- */
.container{max-width:1200px;margin:0 auto;padding:90px 14px 40px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
.input,select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.02);color:#fff}
.input{min-width:160px}

/* Grid: mobile 2 per row, tablet 3, desktop 4 */
.grid{display:grid;gap:14px;grid-template-columns:repeat(2,1fr)}
@media(min-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }
@media(min-width:1200px){ .grid{grid-template-columns:repeat(4,1fr)} }

/* Card */
.card{
  background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
  border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);transition:transform .16s,box-shadow .16s;cursor:default;
}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.6)}
.thumb{width:100%;height:140px;object-fit:cover;border-radius:10px;background:#000}
.title{font-size:15px;margin:8px 0 4px}
.desc{font-size:13px;opacity:.85;height:44px;overflow:hidden}
.meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.badge{padding:5px 8px;border-radius:18px;font-weight:800}
.badge.free{background:#00ff9c;color:#000}
.badge.paid{background:#ff5b5b;color:#fff}
.btn{display:block;text-align:center;padding:10px;border-radius:10px;background:linear-gradient(90deg,#00d8ff,#0075ff);color:#001;font-weight:800;text-decoration:none;margin-top:10px}

/* code input style */
.codeBox input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;caret-color:#ffd54f;font-size:14px}
.codeBox input::placeholder{color:rgba(255,255,255,0.45)}
.codeBox button{width:100%;margin-top:8px;padding:10px;border-radius:10px;border:none;background:#ffc107;color:#000;font-weight:800}

/* Modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(1,1,1,0.6),rgba(1,1,1,0.6));z-index:80;padding:18px}
.modal.show{display:flex}
.modal-card{width:920px;max-width:98%;background:#071026;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.modal-body{display:grid;grid-template-columns:280px 1fr;gap:14px}
.modal img{width:100%;border-radius:10px}

/* empty */
.empty{text-align:center;padding:40px;color:#9aa3b2}

/* small helpers */
.small{font-size:13px;opacity:.85}
.tag{display:inline-block;padding:4px 8px;border-radius:8px;background:rgba(255,255,255,0.03);margin-left:6px;font-size:12px}

/* ensure inputs visible on mobile when focused */
html,body, .modal, .sidebar { -webkit-tap-highlight-color: transparent; }
</style>
</head>
<body id="body">

<canvas id="bg"></canvas>

<!-- Header -->
<div class="header">
  <div class="brand">
    <div class="logo">DS</div>
    <h1>متجر دارغون سوداني</h1>
  </div>

  <div class="controls">
    <div class="sidebar-toggle" id="toggleBtn" title="القائمة">☰ القائمة</div>
  </div>
</div>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar" aria-hidden="true">
  <div class="side-section">
    <div class="side-title">تصفح سريع</div>
    <a href="#" class="side-link" onclick="filterSet('all');return false;">كل المحتوى</a>
    <a href="#" class="side-link" onclick="filterSet('app');return false;">التطبيقات</a>
    <a href="#" class="side-link" onclick="filterSet('code');return false;">أكواد</a>
    <a href="#" class="side-link" onclick="filterSet('sketchware');return false;">مشاريع Sketchware</a>
    <a href="#" class="side-link" onclick="filterSet('tool');return false;">أدوات أخلاقية</a>
  </div>

  <div class="side-section">
    <div class="side-title">حول</div>
    <div class="small">منصة تعليمية لمواضيع الأمن الأخلاقي، مشاريع Sketchware، وأمثلة برمجية. البريد: <b style="color:#00e0ff">alsmanu123456@gmail.com</b></div>
  </div>
</aside>

<!-- Modal -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 id="mTitle"></h3>
      <button onclick="closeModal()" style="background:none;border:none;color:#fff;font-weight:800;cursor:pointer">✕</button>
    </div>

    <div class="modal-body">
      <div>
        <img id="mImg" src="" alt="thumb">
      </div>
      <div>
        <div id="mDesc" class="small"></div>
        <div style="margin-top:10px" class="small"><strong>التصنيف:</strong> <span id="mCat"></span></div>
        <div style="margin-top:8px" class="small"><strong>التقييم:</strong> <span id="mRate"></span> &nbsp; <strong>التحميلات:</strong> <span id="mDownloads"></span></div>
        <div id="mAction" style="margin-top:12px"></div>
        <div style="margin-top:12px;font-size:13px;opacity:.9">للاستفسار: <b style="color:#00e0ff">alsmanu123456@gmail.com</b></div>
      </div>
    </div>
  </div>
</div>

<!-- Main -->
<div class="container">
  <div class="controls">
    <input id="search" class="input" placeholder="ابحث: اسم، وصف، وسم (مثال: VPN, PHP, Sketchware)"/>
    <select id="category" class="input">
      <option value="all">كل الفئات</option>
      <option value="app">تطبيق</option>
      <option value="code">كود</option>
      <option value="sketchware">Sketchware</option>
      <option value="tool">أداة</option>
      <option value="tutorial">تعليم</option>
    </select>
    <select id="paid" class="input">
      <option value="all">الكل</option>
      <option value="free">مجاني</option>
      <option value="paid">مدفوع</option>
    </select>
    <select id="sort" class="input">
      <option value="rate">الأعلى تقييماً</option>
      <option value="downloads">الأكثر تحميلًا</option>
      <option value="new">الأحدث</option>
      <option value="name">الاسم</option>
    </select>
  </div>

  <div id="grid" class="grid"></div>
  <div id="empty" class="empty" style="display:none">لا توجد نتائج. جرّب تعديل عوامل البحث.</div>
</div>

<script>
/* ============= data source =============
   Put this file in the repo root:

   apps.json
   [
     {
       "name": "Dragon VPN",
       "description": "تطبيق تعليمي لاختبار الشبكات (أخلاقي)",
       "rating": 4.8,
       "downloads": 1200,
       "type": "paid",
       "category": "شبكات",
       "apk": "https://www.mediafire.com/file/XXXX/dragon_vpn.apk/file",
       "image": "https://i.ibb.co/XXXX/dragon.png",
       "tags": ["VPN","شبكات","Android"]
     },
     ...
   ]
   ======================================== */

/* State */
let items = [];
let likes = JSON.parse(localStorage.getItem('likes')||'{}');
let downloads = JSON.parse(localStorage.getItem('downloads')||'{}');

/* DOM refs */
const grid = document.getElementById('grid');
const empty = document.getElementById('empty');
const search = document.getElementById('search');
const category = document.getElementById('category');
const paid = document.getElementById('paid');
const sort = document.getElementById('sort');
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('toggleBtn');
const modal = document.getElementById('modal');

/* fetch apps.json */
fetch('apps.json').then(r=>{
  if(!r.ok) throw 'apps.json غير موجود';
  return r.json();
}).then(data=>{
  items = Array.isArray(data)?data:[];
  items.forEach(it=>{
    if(!it.id) it.id = 'id_'+Math.random().toString(36).slice(2,9);
    if(!it.type) it.type = 'free';
    if(!it.category) it.category = 'app';
    if(!it.tags) it.tags = [];
    if(typeof it.rating !== 'number') it.rating = parseFloat(it.rating)||0;
    if(typeof it.downloads !== 'number') it.downloads = parseInt(it.downloads)||0;
  });
  render();
}).catch(e=>{
  grid.innerHTML = '<div class="empty">خطأ في تحميل apps.json: '+String(e)+'</div>';
});

/* helpers */
function esc(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }
function debounce(fn,t=200){ let to; return function(){ clearTimeout(to); to=setTimeout(()=>fn.apply(this,arguments),t); } }

/* render */
function render(){
  const q = (search.value||'').trim().toLowerCase();
  const cat = category.value;
  const paidVal = paid.value;
  const s = sort.value;

  let list = items.slice();

  if(q) list = list.filter(a=>
    (a.name||'').toLowerCase().includes(q) ||
    (a.description||'').toLowerCase().includes(q) ||
    (a.tags||[]).join(' ').toLowerCase().includes(q) ||
    (a.category||'').toLowerCase().includes(q)
  );

  if(cat!=='all') list = list.filter(i => (i.category||'')===cat);
  if(paidVal!=='all') list = list.filter(i => (i.type||'free')===paidVal);

  if(s==='rate') list.sort((a,b)=>(b.rating||0)-(a.rating||0));
  if(s==='downloads') list.sort((a,b)=>(downloads[b.id]||b.downloads||0)-(downloads[a.id]||a.downloads||0));
  if(s==='new') list.sort((a,b)=>(b.id||0)-(a.id||0));
  if(s==='name') list.sort((a,b)=>(a.name||'').localeCompare(b.name||''));

  grid.innerHTML='';
  if(list.length===0){ empty.style.display='block'; return } else empty.style.display='none';

  list.forEach(it=> grid.appendChild(card(it)));
}

/* card builder */
function card(it){
  const el = document.createElement('article'); el.className='card';
  const tagsHtml = (it.tags||[]).slice(0,4).map(t=>`<span class="tag">${esc(t)}</span>`).join('');
  el.innerHTML = `
    <div style="position:relative">
      <img class="thumb" src="${esc(it.image||'')}" alt="${esc(it.name||'')}" onerror="this.style.opacity=.45;this.src='data:image/svg+xml;charset=UTF-8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=600 height=400><rect width=100% height=100% fill=%23000000 /></svg>'"/>
      <div style="position:absolute;left:12px;top:12px"><span class="badge ${it.type==='free'?'free':'paid'}">${it.type==='free'?'مجاني':'مدفوع'}</span></div>
      <div style="position:absolute;right:12px;top:12px">${esc(it.category||'')}</div>
    </div>
    <div style="margin-top:8px">
      <div class="title">${esc(it.name||'')}</div>
      <div class="desc">${esc(it.description||'')}</div>
      <div class="meta"><div>⭐ ${it.rating||0}</div><div>⬇ ${downloads[it.id]||it.downloads||0} • ❤️ ${likes[it.id]||0}</div></div>
      <div class="action"></div>
      <div style="margin-top:8px">${tagsHtml}</div>
    </div>
  `;

  const action = el.querySelector('.action');

  if(it.type==='free' || localStorage.getItem('unlock_'+it.id) === 'true'){
    const a = document.createElement('a'); a.className='btn'; a.href = it.apk || '#'; a.target='_blank'; a.rel='noopener noreferrer'; a.textContent='تحميل الآن';
    a.onclick = ()=>{ downloads[it.id] = (downloads[it.id]||it.downloads||0)+1; localStorage.setItem('downloads', JSON.stringify(downloads)); };
    action.appendChild(a);
  } else {
    const box = document.createElement('div'); box.className='codeBox';
    box.innerHTML = `<input id="code_input_${escapeId(it.id)}" placeholder="أدخل كود التحميل"><button id="code_btn_${escapeId(it.id)}">تفعيل التحميل</button>`;
    action.appendChild(box);
    const input = box.querySelector('input');
    const btn = box.querySelector('button');
    // make sure input visible on mobile keyboard
    input.addEventListener('focus', ()=>{ setTimeout(()=>{ input.scrollIntoView({behavior:'smooth',block:'center'}); }, 220); });
    btn.addEventListener('click', ()=>{
      const v = input.value.trim();
      if(v === (it.code||'')){ localStorage.setItem('unlock_'+it.id,'true'); alert('تم التفعيل'); render(); }
      else alert('كود غير صحيح');
    });
  }

  el.addEventListener('click', (e)=>{ const tag = e.target.tagName.toLowerCase(); if(['input','button','a'].includes(tag)) return; openModal(it); });

  return el;
}

/* escape id */
function escapeId(s){ return String(s).replace(/[^a-z0-9-_]/gi,'_'); }

/* modal */
function openModal(it){
  document.getElementById('mTitle').textContent = it.name || '';
  document.getElementById('mImg').src = it.image || '';
  document.getElementById('mDesc').innerHTML = esc(it.description || '');
  document.getElementById('mRate').textContent = (it.rating||0) + ' ★';
  document.getElementById('mDownloads').textContent = (downloads[it.id]||it.downloads||0) + ' مرات';
  document.getElementById('mCat').textContent = it.category || '';
  const actionArea = document.getElementById('mAction'); actionArea.innerHTML = '';

  if(it.type==='free' || localStorage.getItem('unlock_'+it.id) === 'true'){
    const a = document.createElement('a'); a.className='btn'; a.href = it.apk || '#'; a.target='_blank'; a.rel='noopener noreferrer'; a.textContent='تحميل الآن';
    a.onclick = ()=>{ downloads[it.id] = (downloads[it.id]||it.downloads||0)+1; localStorage.setItem('downloads', JSON.stringify(downloads)); };
    actionArea.appendChild(a);
  } else {
    const box = document.createElement('div'); box.className='codeBox';
    box.innerHTML = `<input id="modal_code_${escapeId(it.id)}" placeholder="أدخل كود التفعيل"><button id="modal_btn_${escapeId(it.id)}">تفعيل وفتح التحميل</button>`;
    actionArea.appendChild(box);
    const input = box.querySelector('input');
    const btn = box.querySelector('button');
    input.addEventListener('focus', ()=>{ setTimeout(()=>{ input.scrollIntoView({behavior:'smooth',block:'center'}); }, 220); });
    btn.addEventListener('click', ()=>{
      const v = input.value.trim();
      if(v === (it.code||'')){ localStorage.setItem('unlock_'+it.id,'true'); alert('تم التفعيل'); closeModal(); render(); }
      else alert('كود غير صحيح');
    });
  }

  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
}
function closeModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

/* filters & events */
search.addEventListener('input', debounce(()=>render(),200));
category.addEventListener('change', ()=>render());
paid.addEventListener('change', ()=>render());
sort.addEventListener('change', ()=>render());
function filterSet(v){ category.value = v; render(); }

/* sidebar toggle */
toggleBtn.addEventListener('click', ()=>{ sidebar.classList.toggle('open'); });
window.addEventListener('click', (e)=>{ if(!sidebar.contains(e.target) && !toggleBtn.contains(e.target)) sidebar.classList.remove('open'); });

/* keyboard shortcuts */
document.addEventListener('keydown',(e)=>{ if(e.key==='/' && document.activeElement !== search){ e.preventDefault(); search.focus(); } if(e.key==='Escape') closeModal(); });

/* init */
function init(){ render(); }
init();

/* ============= background particles ============= */
const canvas = document.getElementById('bg'), ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas(); window.addEventListener('resize', resizeCanvas);

let particles = Array.from({length:Math.round(Math.max(28, innerWidth/35))}, ()=>({
  x: Math.random()*canvas.width,
  y: Math.random()*canvas.height,
  r: Math.random()*1.6 + 0.6,
  dx: (Math.random()-0.5)*0.6,
  dy: (Math.random()-0.5)*0.6,
  hue: 185 + Math.random()*70
}));

(function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x += p.dx; p.y += p.dy;
    if(p.x < -10) p.x = canvas.width+10;
    if(p.x > canvas.width+10) p.x = -10;
    if(p.y < -10) p.y = canvas.height+10;
    if(p.y > canvas.height+10) p.y = -10;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle = `hsla(${p.hue},70%,55%,0.08)`;
    ctx.fill();
  });
  requestAnimationFrame(draw);
})();
</script>
</body>
</html>
